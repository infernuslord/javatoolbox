<!-- ===========================================================================
    
  Maven Base Project Customizations
  
  USAGE:

    You do not invoke this file explicitly. It is picked up by Maven 
    automatically if 'maven.xml' exists in the same directory as the Maven
    project file that is being executed (usually project.xml, but in our case
    base-project.xml). Goals that are defined in this file can be passed to
    maven via the command line to be executed. Execute maven with no command
    line args to print out additional help information on each of the goals.

  PURPOSE:
  
    This file contains additional behavior that is applicable and common to the
    build process of each individual PWSW sub-project (framework, rules, etc).
    
  EXAMPLE:
  
    maven cvs-update    

============================================================================ -->

<project
  default="help"
  xmlns:maven="jelly:maven"
  xmlns:j="jelly:core"
  xmlns:u="jelly:util"
  xmlns:ant="jelly:ant"
  xmlns:bsf="jelly:bsf">

    <!-- =================================================================== -->
    <!-- GOAL : UPDATE-PROPS                                                 -->
    <!-- =================================================================== -->
    <goal name="update-props" description="Copy build.properties to $HOME">
        <property environment="sysenv"/>
        <copy todir="${sysenv.USERPROFILE}" verbose="true" overwrite="true">
            <fileset dir="${basedir}" includes="build.properties"/>
        </copy>
    </goal> 
  
  
    <!-- =================================================================== -->
    <!-- PRE : JAVA : COMPILE                                                -->
    <!-- =================================================================== -->
    <preGoal name="java:compile"> 
       <!-- Piggybacks the debug source tree onto the compile goal -->
       <path id="debug.src" location="${basedir}/debug"/> 
       <maven:addPath id="maven.compile.src.set" refid="debug.src"/> 
    </preGoal> 


    <!-- =================================================================== -->
    <!-- PRE:TEST                                                            -->
    <!-- =================================================================== -->
    
    <!--
    <preGoal name="test:crap">

       
       <ant:pathconvert targetos="windows" property="crap" refid="${maven.dependency.classpath}"/>
       
       
       <property name="crap" refid="maven.dependency.classpath"/>
       <set var="crap" value="${basedir};${crap}"/>
       <set var="maven.dependency.classpath" value="${crap}"/>
       <path id="maven.dependency.classpath" location="${basedir}"/>
       
       <echo message="crap=${crap}"/>
       <echo message="Before Pregoal Test: ${maven.dependency.classpath}"/>
       <echo message=""/>
              
       <path id="hacked" location="${basedir}/classes"/>
       <maven:addPath id="hacked" refid="maven.dependency.classpath"/>
       <j:set var="maven.dependency.classpath" value="${hacked}"/>
       
       <echo message=""/>
       <echo message="After Pregoal Test: ${maven.dependency.classpath}"/>
       <echo message=""/>
       
    </preGoal> 
    -->


    <!-- =================================================================== -->
    <!-- POST : XDOC : REGISTER-REPORTS                                      -->
    <!-- =================================================================== -->
    <postGoal name="xdoc:register-reports"> 
        <attainGoal name="maven-linkcheck-plugin:deregister"/> 
        <attainGoal name="maven-checkstyle-plugin:deregister"/> 
    </postGoal>
      
    
    <!-- =================================================================== -->
    <!-- C V S - U P D A T E                                                 -->
    <!-- =================================================================== -->
    <goal name="cvs-update" description="Updates the project from CVS">

      <mkdir dir="${basedir}/src"/>
    
      <!-- Only the uiframework module has a 'src' dir built into the cvs structure -->
      <j:set var="dest" value="${basedir}/src"/>
      <j:if test="${pom.artifactId == 'uiframework'}">
        <j:set var="dest" value="${basedir}"/>
      </j:if>
    
      <!-- Update from CVS. TODO: Clean checkout -->
      <cvs command     = "update -d"
           dest        = "${dest}"
           failonerror = "false"/>
           <!-- noexec  = "true" -->         
    </goal>


    <!-- =================================================================== -->
    <!-- J N L P - D E P L O Y                                               -->
    <!-- =================================================================== -->
    <goal name="jnlp-deploy" description="Deploys the JNLP distribution to Tomcat">
      <copy todir="${toolbox.jnlp.deploy}" 
            verbose="true"
            quiet="false" 
            overwrite="false">
        <fileset dir="${basedir}/target/jnlp" includes="*.*"/>
      </copy>
    </goal> 


    <!-- =================================================================== -->
    <!-- POST : XDOC : REGISTER-REPORTS    jnlp:generate-jnlp"                                  -->
    <!-- =================================================================== -->
    <goal name="script"> 
    
        <echo>jnlp post goal</echo>
        
        <!-- Prints out the classpath -->        
        <bsf:script language="beanshell"> <![CDATA[
            print("[CLASSPATH]");
            /*
            sb = new StringBuffer();
            cp = toolbox.getProperty("cp");
            for (t = new StringTokenizer(cp, File.pathSeparator); t.hasMoreTokens(); )
                sb.append(t.nextToken() + System.getProperty("line.separator"));
            print(sb.toString());
            */
        ]]>
        </bsf:script>
       
    </goal>



    <!-- =================================================================== -->
    <!-- A L I A S E S                                                       -->
    <!-- =================================================================== -->
    <goal name="compile" description="Alias for java:compile">
		<attainGoal name="java:compile"/>
    </goal>
      
    <goal name="jar" description="Alias for jar:install">
    	<attainGoal name="jar:install"/>
    </goal>


    <!-- =================================================================== -->
    <!-- H E L P                                                             -->
    <!-- =================================================================== -->
    <goal name="help" description="Help for build targets">
        <echo>
================================================================================
                             Project Build Help
================================================================================

Scope: 

  Maven goals for Toolbox

Commands:

  clean         Deletes residual class files, jars, directories generated by 
                the build process.
  compile       Compiles the project only.
  cvs-update    Does a cvs update of the project.
  jar           Compiles, unit tests, and jars the project.
  jnlp          Creates jnlp distribution in target/jnlp
  jnlp-deploy   Copies the jnlp distribution to the http server
  test          Runs unit tests
  site          Generates project website with reports and all.
  update-props  Copies build.properties to $HOME

================================================================================
        </echo>
    </goal>
</project>